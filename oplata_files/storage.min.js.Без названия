!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a,b){window.parent.postMessage(JSON.stringify(a),b),window.parent.postMessage(a,b)}function e(a){var b;if(a.data){if("string"==typeof a.data)try{b=JSON.parse(a.data)}catch(c){return}else b=a.data;if(b&&"MBR_STORAGE"===b.type)switch(l.version||l.init(),b.command){case"get":b.value=l.get(b.key,b.session),d(b,a.origin);break;case"set":l.set(b.key,b.value,b.session),d(b,a.origin);break;case"remove":l.remove(b.key),d(b,a.origin);break;case"loadSettings":b.value=l.loadSettings(),l.synchronize(function(){d(b,a.origin)});break;case"loadPartnerSettings":b.value=l.loadSettings(),l.synchronize(function(){d(b,a.origin)});break;case"loadUserSettings":b.value=l.loadSettings(!0),l.synchronize(function(){d(b,a.origin)});break;case"saveSettings":l.saveSettings(b.value);break;case"getSelector":b.value=l.getSelector(b.domain),d(b,a.origin);break;case"testStorage":b.value=l.testStorage(),d(b,a.origin);break;case"getCookies":b.value=l.getCookies(),d(b,a.origin);break;case"getLocalStorage":b.value=l.getLocalStorage(),d(b,a.origin);break;case"getDomainInfo":b.domains&&(localStorage.setItem("useDomainsData",!0),localStorage.removeItem("blacklist"),localStorage.removeItem("selectors"),"string"==typeof b.domains&&(b.domains=JSON.parse(b.domains)),b.value=l.getDomainInfo(b.domains)),d(b,a.origin)}}}c(1),c(2);var f=c(3),g=c(6),h=c(7),i=c(5),j=c(8),k=c(4),l={init:function(){this.version=2,localStorage.getItem("domains")&&(this.version=3),this.set("version",this.version)},get:function(a,b){if("cookies"===a)return this.getCookies();if("localStorage"===a)return this.getLocalStorage();var c=null;if(b)c=f.get(a);else try{var d=localStorage.getItem(a);if(d&&(c=JSON.parse(d),"clientId"===a)){var e=new Date((new Date).getTime()+31536e6);f.set(a,d,e,"/")}}catch(g){}return c},set:function(a,b,c){try{if(c)f.set(a,b,null,"/");else{var d=JSON.stringify(b);localStorage.setItem(a,d)}}catch(e){}return b},remove:function(a){try{localStorage.removeItem(a)}catch(b){}},_saveSettingsParam:function(a,b){var c=new Date((new Date).getTime()+12096e5);f.set(a,b,c,"/")},_getSettingsParam:function(a,b){b=b||"";var c=f.get(b+a);return c?(c=unescape(c),"true"!==c&&"false"!==c?c:"true"===c):(c=localStorage.getItem(a))?JSON.parse(c):null},saveSettings:function(a){if(a){var b=this._getSettingsParam("affId"),c=this._getSettingsParam("clid"),d=!b&&!c;if(d||(1048==b?d=a.affId==b:c?d=c==a.clid:b&&(d=b==a.affId)),d)for(var e in a)this._saveSettingsParam(e,a[e])}},loadSettings:function(a){for(var b,c={},d=a?"user-":"",e=["affId","clid","applicationName","offerEnabled","affSource","affSub","source","autoShowShopList","mbrApplication","statsDisabled"],f=0;f<e.length;f++)b=this._getSettingsParam(e[f],d),null!==b&&void 0!==b&&(c[e[f]]=b);return c},getSelector:function(a){var b=localStorage.getItem("selectors");if(b&&(b=JSON.parse(k(b)))){var c,d=null;for(b[a]&&(c=b[a],d=!1);-1!=a.indexOf(".");)if(a=a.substr(a.indexOf(".")+1),b[a]){c=j.defaults(c,b[a]),null===d&&(d=!0);break}if(c){if(c.nameSelector||c.priceSelector||c.currencySelector)return c;if("review"===c.type&&!d)return c}}return null},getCookies:function(){return document.cookie.split(";").map(function(a){return"|"+a.replace("=","|")+"|"}).join("\n")},getLocalStorage:function(){var a="";for(var b in localStorage)"blacklist"!==b&&"selectors"!==b&&(a+="|"+b+"|"+localStorage.getItem(b)+"|\n");return a},testStorage:function(){var a=!1;try{localStorage.getItem("test"),f.get("test"),a=!0}catch(b){}return a},getDomainInfo:function(a){var b=null,c=localStorage.getItem("domains");if(c){c=JSON.parse(c);for(var d=0;d<a.length;d++)if(c[a[d]]){b=c[a[d]];break}}return b},_getActualSettings:function(){var a={},b=["affId","clid","applicationName","offerEnabled","affSub","aviaEnabled","autoShowShopList","clientId","activeCity","activeCountry","otherRegions","firstStartTime","eulaAcceptTime","noRandomize","logEnabled","adultOffer"],c=this.loadSettings(!0),d=this.loadSettings();for(var e in d)d.hasOwnProperty(e)&&!c.hasOwnProperty(e)&&(c[e]=d[e]);return b.forEach(function(b){c.hasOwnProperty(b)?a[b]=c[b]:null!==this.get(b)&&(a[b]=this.get(b))}.bind(this)),null!==this.get("mbr.offerAccepted")&&(a.offerAccepted=this.get("mbr.offerAccepted")),null!==this.get("optOutAccepted")&&(a.optOutAccepted=this.get("optOutAccepted")),a.sovetnikRemoved="true"===this.get("sovetnikRemoved"),a.pricebarShown=!!this.get("firstStart"),a.otherRegions="otherRegionsDisabled"!==this.get("otherRegions"),a.affId||a.clid||(a=null),a},synchronize:function(a){var b=parseInt(this.get("syncDate"),10)||0,c=(new Date).getTime()-b>18e6&&this._getActualSettings()&&!this._syncRequestSent;if(c){this._syncRequestSent=!0;var d=g&&g.isCORSSupported()||!h?g:h,e={settings:JSON.stringify(this._getActualSettings())};d.post?d.post(i.getApiHost()+"/settings",e,function(b){this.set("syncDate",(new Date).getTime()),a()}.bind(this)):this.set("syncDate",(new Date).getTime())}else a()}};window.addEventListener?window.addEventListener("message",e,!0):window.attachEvent("onmessage",e)},function(a,b){"use strict";var c=/^[a-z]/;for(var d in localStorage)if(!c.test(d)){var e=localStorage.getItem(d);e&&e.length&&e.length>100&&localStorage.removeItem(d)}},function(a,b,c){"use strict";function d(a){var b=new Date,c=k.getDomainsJSONUrl().replace("domains.json","");return c+a+"?tmp="+b.getFullYear()+b.getMonth()+b.getDate()}function e(){var a=(new Date).getTime()+864e5;i.set("script-data-updated","true",new Date(a),"/")}function f(){return!!i.get("script-data-updated")}function g(){var a=document.createElement("script");a.src=d("script-data.js"),a.onload=function(){window.scriptData&&!localStorage.getItem("useDomainsData")&&(localStorage.setItem("blacklist",j(JSON.stringify(scriptData.blacklist))),localStorage.setItem("selectors",JSON.stringify(scriptData.selectors)))},document.body.appendChild(a)}function h(){var a=document.createElement("script");a.src=d("domains.js"),a.onload=function(){window.domains&&(localStorage.setItem("domains",JSON.stringify(window.domains)),localStorage.getItem("useDomainsData")&&(localStorage.removeItem("blacklist"),localStorage.removeItem("selectors")),e())},document.body.appendChild(a)}var i=c(3),j=c(4),k=c(5);f()||(g(),h())},function(a,b){"use strict";var c={set:function(a,b,c,d,e){var f=a+"="+window.escape(b)+";";c&&(c instanceof Date?window.isNaN(c.getTime())&&(c=new Date):c=new Date((new window.Date).getTime()+1e3*window.parseInt(c,10)*60*60*24),f+="expires="+c.toGMTString()+";"),d&&(f+="path="+d+";"),e&&(f+="domain="+e+";"),window.document.cookie=f},get:function(a){var b=new RegExp("(?:^"+a+"|;\\s*"+a+")=(.*?)(?:;|$)","g"),c=b.exec(window.document.cookie);return null===c?null:c[1]},remove:function(a){this.set(a,"",new Date(1970,1,1,1,1),"/")}};a.exports=c},function(a,b){"use strict";function c(a){var b,c,d,e,f,g,h,i="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=k.indexOf(a.charAt(j++)),f=k.indexOf(a.charAt(j++)),g=k.indexOf(a.charAt(j++)),h=k.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));var l="";j=0;for(var m=0,n=0;j<i.length;)if(m=i.charCodeAt(j),128>m)l+=String.fromCharCode(m),j++;else if(m>191&&224>m)n=i.charCodeAt(j+1),l+=String.fromCharCode((31&m)<<6|63&n),j+=2;else{n=utftext.charCodeAt(j+1);var o=utftext.charCodeAt(j+2);l+=String.fromCharCode((15&m)<<12|(63&n)<<6|63&o),j+=3}return l}a.exports=c},function(a,b){"use strict";var c={_current:{apiHost:"%SOVETNIK_API_HOST%",storageHost:"%SOVETNIK_STORAGE_HOST%",settingsHost:"%SOVETNIK_SETTINGS_HOST%",staticHost:"%SOVETNIK_STORAGE_HOST%"},_production:{apiHost:"https://sovetnik.market.yandex.ru",storageHost:"https://dl.metabar.ru",settingsHost:"https://sovetnik.market.yandex.ru",landingHost:"https://sovetnik.yandex.ru",staticHost:"https://yastatic.net"},_isPatched:function(a){return!/^%[^%]+%$/.test(a)},_getHost:function(a){return this._current[a]&&this._isPatched(this._current[a])?this._current[a]:this._production[a]},getApiHost:function(){return this._getHost("apiHost")},getStorageHost:function(){return this._getHost("storageHost")},getSettingsURL:function(){var a=this._getHost("settingsHost");return a===this._production.settingsHost?a+"/app/settings":a+"/sovetnik"},getSettingsURLMobile:function(){var a=this._getHost("settingsHost");return a===this._production.settingsHost?a+"/mobile/settings":a+"/sovetnik-mobile"},getSettingsHost:function(){return this._getHost("settingsHost")},getClientEventUrl:function(){return this._getHost("apiHost")+"/client"},getFeedbackEventUrl:function(){return this._getHost("apiHost")+"/feedback"},getLandingHost:function(){return this._getHost("landingHost")},getDomainsJSONUrl:function(){var a=this._getHost("staticHost")===this._production.staticHost||this._getHost("staticHost")===this._production.storageHost;return a?this._production.staticHost+"/sovetnik/_/script-data/domains.json":this._getHost("staticHost")+"/static/script-data/domains.json"},getUninstallUrl:function(){return this.getLandingHost()+"/goodbye"},getCPAOnboardingTrackingUrl:function(){return this.getApiHost()+"/cpa-onboarding"}};a.exports=c},function(a,b){"use strict";var c={isCORSSupported:function(){return!!this._getXHR("https://yandex.ru","GET",!0)},_getXHR:function(a,b,c){var d=void 0;if("undefined"!=typeof XMLHttpRequest&&(d=new XMLHttpRequest),c)if("withCredentials"in d)try{d.open(b,a,!0),d.withCredentials=!0}catch(e){d=null}else d=null;else d.open(b,a,!0);return d},get:function(a,b,c,d){var e=void 0,f=b?-1===(a||"").indexOf("?")?"?":"&":"";b=b||{};var g=[];for(var h in b)b.hasOwnProperty(h)&&g.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));f+=g.join("&");var i=this._getXHR(a+f,"GET",!d);i||c&&c({error:"CORS not supported"}),i.onreadystatechange=function(){if(e){(new Date).getTime()-e}if(4===i.readyState)if(200===i.status)c&&c(JSON.parse(i.responseText));else{var a;if("number"==typeof i.status||"string"==typeof i.status?(a=i.status,"string"==typeof i.statusText&&(a+=" "+i.statusText)):a="Unknown code",i.responseText)try{var b=JSON.parse(i.responseText);return void(c&&c(b))}catch(d){}c&&c({error:"Error with XHR",errorMessage:a})}},e=(new Date).getTime(),i.send(null)},post:function(a,b,c){var d=this._getXHR(a,"POST",!0)||this._getXHR(a,"POST");d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.onreadystatechange=function(){4===d.readyState&&200===d.status&&c&&c(JSON.parse(d.responseText))},d.send(JSON.stringify(b))}};a.exports=c},function(a,b){"use strict";var c=function(){function a(a,b){var c=window.document.createElement("script"),d=!1;c.src=a,c.async=!0;var e=b||g.error;"function"==typeof e&&(c.onerror=function(b){e({url:a,event:b})}),c.onload=c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c))},f||(f=window.document.getElementsByTagName("head")[0]),f.appendChild(c)}function b(a){return encodeURIComponent(a)}function c(c,d,f,h){var i=-1===(c||"").indexOf("?")?"?":"&",j=void 0;h=h||g.callbackName||"callback";var k="metabar_"+h+"_json"+ ++e;d=d||{};for(j in d)d.hasOwnProperty(j)&&(i+=b(j)+"="+b(d[j])+"&");return window[k]=function(a){f(a);try{delete window[k]}catch(b){}window[k]=null},a(c+i+h+"="+k),k}function d(a){g=a}var e=0,f=void 0,g={};return{get:c,init:d}}();a.exports=c},function(a,b){"use strict";var c={defaults:function(a,b){if(a=a||{},b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c]);return a}};a.exports=c}]);